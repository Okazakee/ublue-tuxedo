# Universal Blue Tuxedo

Universal Blue OCI images with official Tuxedo drivers and TCC (Tuxedo Control Center) for InfinityBook laptops.

Supports **Aurora** (KDE Plasma), **Bluefin** (GNOME), and **Bazzite** (Gaming/Desktop/Deck) with stable/latest kernel variants, NVIDIA support, and open-source NVIDIA drivers. **36 total variants available** - the most comprehensive Universal Blue Tuxedo collection!

## Available Images

<details open>
<summary><h3 style="display: inline;">üñ•Ô∏è Aurora Variants (KDE Plasma Desktop) - 8 variants</h3></summary>

- **aurora-tuxedo:stable** - `ghcr.io/okazakee/aurora-tuxedo:stable` - Gated kernel (weekly updates)
- **aurora-tuxedo:latest** - `ghcr.io/okazakee/aurora-tuxedo:latest` - Newest kernel
- **aurora-tuxedo-dx:stable** - `ghcr.io/okazakee/aurora-tuxedo-dx:stable` - Dev tools + gated kernel
- **aurora-tuxedo-dx:latest** - `ghcr.io/okazakee/aurora-tuxedo-dx:latest` - Dev tools + newest kernel
- **aurora-nvidia-tuxedo:stable** - `ghcr.io/okazakee/aurora-nvidia-tuxedo:stable` - NVIDIA drivers + gated kernel
- **aurora-nvidia-tuxedo:latest** - `ghcr.io/okazakee/aurora-nvidia-tuxedo:latest` - NVIDIA drivers + newest kernel
- **aurora-dx-nvidia-tuxedo:stable** - `ghcr.io/okazakee/aurora-dx-nvidia-tuxedo:stable` - Dev tools + NVIDIA + gated kernel
- **aurora-dx-nvidia-tuxedo:latest** - `ghcr.io/okazakee/aurora-dx-nvidia-tuxedo:latest` - Dev tools + NVIDIA + newest kernel

</details>

<details>
<summary><h3 style="display: inline;">üêß Bluefin Variants (GNOME Desktop) - 8 variants</h3></summary>

- **bluefin-tuxedo:stable** - `ghcr.io/okazakee/bluefin-tuxedo:stable` - Gated kernel (weekly updates)
- **bluefin-tuxedo:latest** - `ghcr.io/okazakee/bluefin-tuxedo:latest` - Newest kernel
- **bluefin-tuxedo-dx:stable** - `ghcr.io/okazakee/bluefin-tuxedo-dx:stable` - Dev tools + gated kernel
- **bluefin-tuxedo-dx:latest** - `ghcr.io/okazakee/bluefin-tuxedo-dx:latest` - Dev tools + newest kernel
- **bluefin-nvidia-tuxedo:stable** - `ghcr.io/okazakee/bluefin-nvidia-tuxedo:stable` - NVIDIA drivers + gated kernel
- **bluefin-nvidia-tuxedo:latest** - `ghcr.io/okazakee/bluefin-nvidia-tuxedo:latest` - NVIDIA drivers + newest kernel
- **bluefin-dx-nvidia-tuxedo:stable** - `ghcr.io/okazakee/bluefin-dx-nvidia-tuxedo:stable` - Dev tools + NVIDIA + gated kernel
- **bluefin-dx-nvidia-tuxedo:latest** - `ghcr.io/okazakee/bluefin-dx-nvidia-tuxedo:latest` - Dev tools + NVIDIA + newest kernel

</details>

<details>
<summary><h3 style="display: inline;">üéÆ Bazzite Gaming Variants (KDE Plasma) - 6 variants</h3></summary>

- **bazzite-tuxedo:stable** - `ghcr.io/okazakee/bazzite-tuxedo:stable` - Gaming-optimized with gated kernel
- **bazzite-tuxedo:latest** - `ghcr.io/okazakee/bazzite-tuxedo:latest` - Gaming-optimized with newest kernel
- **bazzite-nvidia-tuxedo:stable** - `ghcr.io/okazakee/bazzite-nvidia-tuxedo:stable` - Gaming + NVIDIA proprietary + gated kernel
- **bazzite-nvidia-tuxedo:latest** - `ghcr.io/okazakee/bazzite-nvidia-tuxedo:latest` - Gaming + NVIDIA proprietary + newest kernel
- **bazzite-nvidia-open-tuxedo:stable** - `ghcr.io/okazakee/bazzite-nvidia-open-tuxedo:stable` - Gaming + NVIDIA open + gated kernel
- **bazzite-nvidia-open-tuxedo:latest** - `ghcr.io/okazakee/bazzite-nvidia-open-tuxedo:latest` - Gaming + NVIDIA open + newest kernel

</details>

<details>
<summary><h3 style="display: inline;">üåê Bazzite GNOME Variants (Desktop) - 6 variants</h3></summary>

- **bazzite-gnome-tuxedo:stable** - `ghcr.io/okazakee/bazzite-gnome-tuxedo:stable` - GNOME desktop + gated kernel
- **bazzite-gnome-tuxedo:latest** - `ghcr.io/okazakee/bazzite-gnome-tuxedo:latest` - GNOME desktop + newest kernel
- **bazzite-gnome-nvidia-tuxedo:stable** - `ghcr.io/okazakee/bazzite-gnome-nvidia-tuxedo:stable` - GNOME + NVIDIA proprietary + gated kernel
- **bazzite-gnome-nvidia-tuxedo:latest** - `ghcr.io/okazakee/bazzite-gnome-nvidia-tuxedo:latest` - GNOME + NVIDIA proprietary + newest kernel
- **bazzite-gnome-nvidia-open-tuxedo:stable** - `ghcr.io/okazakee/bazzite-gnome-nvidia-open-tuxedo:stable` - GNOME + NVIDIA open + gated kernel
- **bazzite-gnome-nvidia-open-tuxedo:latest** - `ghcr.io/okazakee/bazzite-gnome-nvidia-open-tuxedo:latest` - GNOME + NVIDIA open + newest kernel

</details>

<details>
<summary><h3 style="display: inline;">üéØ Bazzite Deck Variants (Steam Deck UI) - 8 variants</h3></summary>

- **bazzite-deck-tuxedo:stable** - `ghcr.io/okazakee/bazzite-deck-tuxedo:stable` - Steam Deck UI + gated kernel
- **bazzite-deck-tuxedo:latest** - `ghcr.io/okazakee/bazzite-deck-tuxedo:latest` - Steam Deck UI + newest kernel
- **bazzite-deck-nvidia-tuxedo:stable** - `ghcr.io/okazakee/bazzite-deck-nvidia-tuxedo:stable` - Deck UI + NVIDIA + gated kernel
- **bazzite-deck-nvidia-tuxedo:latest** - `ghcr.io/okazakee/bazzite-deck-nvidia-tuxedo:latest` - Deck UI + NVIDIA + newest kernel
- **bazzite-deck-gnome-tuxedo:stable** - `ghcr.io/okazakee/bazzite-deck-gnome-tuxedo:stable` - Deck UI + GNOME + gated kernel
- **bazzite-deck-gnome-tuxedo:latest** - `ghcr.io/okazakee/bazzite-deck-gnome-tuxedo:latest` - Deck UI + GNOME + newest kernel
- **bazzite-deck-nvidia-gnome-tuxedo:stable** - `ghcr.io/okazakee/bazzite-deck-nvidia-gnome-tuxedo:stable` - Deck UI + GNOME + NVIDIA + gated kernel
- **bazzite-deck-nvidia-gnome-tuxedo:latest** - `ghcr.io/okazakee/bazzite-deck-nvidia-gnome-tuxedo:latest` - Deck UI + GNOME + NVIDIA + newest kernel

</details>

## Features

- **Official Tuxedo Support**: Uses the official Tuxedo Fedora repository
- **Pre-built Kernel Modules**: DKMS modules built and installed during image creation
- **Secure Boot Support**: Aurora key path with MOK enrollment fallback
- **InfinityBook Optimizations**: Proven fixes for Gen9/10 models
- **Smart CI**: Checks all base images (Aurora, Bluefin, Bazzite) and only builds when updates are available
- **Multi-Variant Support**: Aurora, Bluefin, and Bazzite with stable/latest variants

## Quick Start

### Rebasing to Tuxedo Images

Choose your preferred desktop environment and variant:

<details>
<summary><h4 style="display: inline;">üñ•Ô∏è Aurora (KDE Plasma Desktop)</h4></summary>

```bash
# Stable (Recommended)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/aurora-tuxedo:stable

# Latest (Newest features)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/aurora-tuxedo:latest

# DX Stable (Dev tools + stable kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/aurora-tuxedo-dx:stable

# DX Latest (Dev tools + newest kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/aurora-tuxedo-dx:latest

# NVIDIA Stable (NVIDIA drivers + stable kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/aurora-nvidia-tuxedo:stable

# NVIDIA Latest (NVIDIA drivers + newest kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/aurora-nvidia-tuxedo:latest

# DX NVIDIA Stable (Dev tools + NVIDIA + stable kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/aurora-dx-nvidia-tuxedo:stable

# DX NVIDIA Latest (Dev tools + NVIDIA + newest kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/aurora-dx-nvidia-tuxedo:latest

# Reboot to apply
sudo systemctl reboot
```

</details>

<details>
<summary><h4 style="display: inline;">üêß Bluefin (GNOME Desktop)</h4></summary>

```bash
# Stable (Recommended)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bluefin-tuxedo:stable

# Latest (Newest features)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bluefin-tuxedo:latest

# DX Stable (Dev tools + stable kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bluefin-tuxedo-dx:stable

# DX Latest (Dev tools + newest kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bluefin-tuxedo-dx:latest

# NVIDIA Stable (NVIDIA drivers + stable kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bluefin-nvidia-tuxedo:stable

# NVIDIA Latest (NVIDIA drivers + newest kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bluefin-nvidia-tuxedo:latest

# DX NVIDIA Stable (Dev tools + NVIDIA + stable kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bluefin-dx-nvidia-tuxedo:stable

# DX NVIDIA Latest (Dev tools + NVIDIA + newest kernel)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bluefin-dx-nvidia-tuxedo:latest

# Reboot to apply
sudo systemctl reboot
```

</details>

<details>
<summary><h4 style="display: inline;">üéÆ Bazzite (Gaming & Desktop)</h4></summary>

```bash
# === GAMING VARIANTS (KDE Plasma - Gaming Focused) ===

# Stable (Recommended)
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-tuxedo:stable

# Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-tuxedo:latest

# NVIDIA Proprietary Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-nvidia-tuxedo:stable

# NVIDIA Proprietary Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-nvidia-tuxedo:latest

# NVIDIA Open-Source Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-nvidia-open-tuxedo:stable

# NVIDIA Open-Source Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-nvidia-open-tuxedo:latest

# === GNOME VARIANTS (Desktop Experience) ===

# GNOME Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-gnome-tuxedo:stable

# GNOME Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-gnome-tuxedo:latest

# GNOME + NVIDIA Proprietary Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-gnome-nvidia-tuxedo:stable

# GNOME + NVIDIA Proprietary Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-gnome-nvidia-tuxedo:latest

# GNOME + NVIDIA Open Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-gnome-nvidia-open-tuxedo:stable

# GNOME + NVIDIA Open Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-gnome-nvidia-open-tuxedo:latest

# === DECK VARIANTS (Steam Deck Experience) ===

# Deck Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-deck-tuxedo:stable

# Deck Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-deck-tuxedo:latest

# Deck + NVIDIA Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-deck-nvidia-tuxedo:stable

# Deck + NVIDIA Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-deck-nvidia-tuxedo:latest

# Deck + GNOME Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-deck-gnome-tuxedo:stable

# Deck + GNOME Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-deck-gnome-tuxedo:latest

# Deck + NVIDIA + GNOME Stable
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-deck-nvidia-gnome-tuxedo:stable

# Deck + NVIDIA + GNOME Latest
sudo rpm-ostree rebase ostree-image-signed:docker://ghcr.io/okazakee/bazzite-deck-nvidia-gnome-tuxedo:latest

# Reboot to apply
sudo systemctl reboot
```

</details>

### Add Recommended Kernel Arguments

For InfinityBook Gen9/10 models, add the recommended kernel argument:

```bash
sudo rpm-ostree kargs --append-if-missing acpi.ec_no_wakeup=1
```

**Note**: This addresses EC wake issues as recommended by Tuxedo.

## Secure Boot Setup

The image supports two Secure Boot paths:

### 1. Aurora Key Path (Preferred)

If you're using the Aurora base image, modules may be signed with Aurora's keys:

```bash
sudo /usr/bin/setup-secureboot
```

The script will detect if Aurora keys are available and trusted.

### 2. MOK Enrollment (Fallback)

If Aurora keys aren't available, use MOK enrollment:

```bash
sudo /usr/bin/setup-secureboot
```

The script will automatically import the MOK certificate with the hardcoded password "tuxedo". During reboot, select "Enroll MOK" and enter the password: **tuxedo**.

## Verification

After rebasing, verify the installation:

```bash
# Check if Tuxedo modules are loaded
lsmod | grep tuxedo

# Expected output:
# tuxedo_keyboard
# tuxedo_io

# Launch Tuxedo Control Center
tuxedo-control-center
```

## Troubleshooting

<details>
<summary><h3 style="display: inline;">üîß Modules Not Loading</h3></summary>

1. Check if modules are present:

   ```bash
   ls -la /lib/modules/$(uname -r)/updates/ | grep tuxedo
   ```

2. Manually load modules:

   ```bash
   sudo modprobe tuxedo_keyboard
   sudo modprobe tuxedo_io
   ```

3. Check system logs:
   ```bash
   journalctl -b -u tuxedo-control-center
   dmesg | grep tuxedo
   ```

</details>

<details>
<summary><h3 style="display: inline;">üîí Secure Boot Issues</h3></summary>

1. Check Secure Boot status:

   ```bash
   mokutil --sb-state
   ```

2. If modules fail to load with Secure Boot enabled:

   ```bash
   sudo /usr/bin/setup-secureboot
   ```

3. Verify MOK enrollment:
   ```bash
   mokutil --list-enrolled
   ```

</details>

<details>
<summary><h3 style="display: inline;">üò¥ Suspend/Resume Issues</h3></summary>

The image includes a systemd-sleep hook that reinitializes Tuxedo modules on resume. If you experience issues:

1. Check if the hook is present:

   ```bash
   ls -la /usr/lib/systemd/system-sleep/tuxedo-keyboard
   ```

2. Test manual module reload:
   ```bash
   sudo modprobe -r tuxedo_keyboard tuxedo_io
   sudo modprobe tuxedo_keyboard tuxedo_io
   ```

</details>

<details>
<summary><h3 style="display: inline;">‚èÆÔ∏è Rollback</h3></summary>

If you encounter issues, you can rollback to your previous image:

```bash
sudo rpm-ostree rollback
```

</details>

## Building from Source

<details>
<summary><h3 style="display: inline;">üî® Build Instructions</h3></summary>

### Prerequisites

- Docker or Podman
- Git

### Build Steps

1. Clone the repository:

   ```bash
   git clone https://github.com/okazakee/aurora-tuxedo.git
   cd aurora-tuxedo
   ```

2. Build a specific variant:

   ```bash
   # Build Aurora stable
   docker build -f containerfiles/Containerfile.aurora -t aurora-tuxedo:stable .

   # Or build any other variant
   docker build -f containerfiles/Containerfile.bazzite-nvidia -t bazzite-nvidia-tuxedo:stable .
   ```

3. Test the image:
   ```bash
   docker run --rm aurora-tuxedo:stable bash -c "rpm -qa | grep tuxedo"
   ```

</details>

### Build Process Improvements (PR Pattern)

The build process now includes the proven patterns from [BrickMan240's PR #6](https://github.com/BrickMan240/ublue-tuxedo-tcc/pull/6):

- **Writable Build Location**: Copies DKMS sources to `/tmp/tuxedo-drivers-build` to avoid immutable filesystem issues
- **Explicit Module Installation**: Uses `make modules_install` to ensure modules are properly placed
- **MOK Signing**: Generates MOK keys during build for Secure Boot compatibility
- **Hardcoded Password**: Uses "tuxedo" as the MOK enrollment password for seamless setup

## CI/CD

The repository includes GitHub Actions workflows that:

- Check if Aurora base image has changed
- Build and push the image to GHCR
- Test the built image
- Update the Aurora digest file

### Required Secrets

- `GHCR_PAT`: Personal Access Token with `write:packages` permission

## Architecture

### Containerfile Structure

Each variant uses a different base image:

1. **Stable**: `ghcr.io/ublue-os/aurora:stable` - Weekly updates with gated kernel
2. **Latest**: `ghcr.io/ublue-os/aurora:latest` - Newest features with latest kernel
3. **DX**: `ghcr.io/ublue-os/aurora-dx:latest` - Developer Experience with pre-installed tools

Common build process for all variants:

1. **Repository Setup**: Official Tuxedo Fedora repository
2. **Package Installation**: TCC, drivers, DKMS, build dependencies
3. **Module Building**: DKMS autoinstall with proper module placement
4. **System Integration**: modules-load.d and systemd-sleep hooks
5. **Overlay Files**: Additional configuration files

### Key Components

- **Tuxedo Control Center**: GUI for fan control, brightness, keyboard backlight
- **Tuxedo Drivers**: Kernel modules for hardware control
- **DKMS**: Dynamic Kernel Module Support for automatic rebuilding
- **Secure Boot**: Module signing with Aurora keys or MOK enrollment

## Contributing

1. Fork the repository
2. Create a feature branch
3. Make your changes
4. Test on real hardware if possible
5. Submit a pull request

## License

This project follows the same license as the Aurora base image.

## Support

- **Tuxedo Support**: [Tuxedo Computers Support](https://www.tuxedocomputers.com/en/Support.1.html)
- **Aurora Support**: [Aurora Documentation](https://aurora.blue/)
- **Issues**: [GitHub Issues](https://github.com/okazakee/aurora-tuxedo/issues)

## Acknowledgments

- [Universal Blue](https://universal-blue.org/) for the base images (Aurora, Bluefin, Bazzite)
- [Tuxedo Computers](https://www.tuxedocomputers.com/) for official drivers
- [BrickMan240](https://github.com/BrickMan240) for the original PR and improvements
